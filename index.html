<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ValenTango 2026 Full Schedule</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="transition-colors">

    <header class="main-header sticky top-0 z-40">
        <div class="max-w-2xl mx-auto px-6 pb-6">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h1 class="text-3xl font-extrabold tracking-tight">ValenTango</h1>
                    <p class="text-xs uppercase tracking-widest font-bold mt-1" style="color: var(--text-secondary)">Portland 2026</p>
                </div>
                <button onclick="toggleTheme()" class="theme-toggle" id="theme-btn">Light Mode</button>
            </div>
            
            <div class="flex gap-3 overflow-x-auto no-scrollbar -mx-6 px-6">
                <button onclick="setFilter('all')" id="filter-all" class="filter-chip active">All</button>
                <button onclick="setFilter('milonga')" id="filter-milonga" class="filter-chip">Milongas</button>
                <button onclick="setFilter('Beg')" id="filter-Beg" class="filter-chip">Beg</button>
                <button onclick="setFilter('Int')" id="filter-Int" class="filter-chip">Int</button>
                <button onclick="setFilter('Adv')" id="filter-Adv" class="filter-chip">Adv</button>
            </div>
        </div>
    </header>

    <main id="event-list" class="max-w-2xl mx-auto px-6 pt-4"></main>

    <script src="events.js"></script>
    <script>
        const FILTER_KEY = 'valentango_filter_pref';
        const THEME_KEY = 'valentango_theme_pref';
        
        let currentFilter = 'all';

        function initSettings() {
            try {
                // Filter Init
                const savedFilter = localStorage.getItem(FILTER_KEY);
                if (savedFilter) currentFilter = savedFilter;

                // Theme Init
                const isLight = localStorage.getItem(THEME_KEY) === 'true';
                if (isLight) {
                    document.body.classList.add('light-mode');
                    updateThemeButton(true);
                }
            } catch (e) { console.warn("Storage access denied", e); }
        }

        function toggleTheme() {
            const isLight = document.body.classList.toggle('light-mode');
            updateThemeButton(isLight);
            try {
                localStorage.setItem(THEME_KEY, isLight);
            } catch (e) { console.warn("Could not save theme", e); }
        }

        function updateThemeButton(isLight) {
            const btn = document.getElementById('theme-btn');
            if (btn) btn.innerText = isLight ? "Dark Mode" : "Light Mode";
        }

        function formatTime(iso) { return new Date(iso).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' }); }
        function formatDate(iso) { return new Date(iso).toLocaleDateString([], { weekday: 'long', month: 'short', day: 'numeric' }); }

        function setFilter(filter) {
            currentFilter = filter;
            try { localStorage.setItem(FILTER_KEY, filter); } catch (e) {}
            updateFilterUI();
            renderEvents();
        }

        function updateFilterUI() {
            document.querySelectorAll('.filter-chip').forEach(chip => chip.classList.remove('active'));
            const activeChip = document.getElementById(`filter-${currentFilter}`);
            if (activeChip) activeChip.classList.add('active');
        }

        function renderEvents() {
            const list = document.getElementById('event-list');
            if (!list || typeof events === 'undefined') return;

            list.innerHTML = '';
            const filtered = events.filter(e => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'milonga') return e.type === 'milonga';
                return (e.level || "").toLowerCase().includes(currentFilter.toLowerCase());
            }).sort((a,b) => new Date(a.start) - new Date(b.start));

            let lastDate = '';
            filtered.forEach(e => {
                const dateStr = formatDate(e.start);
                if(dateStr !== lastDate) {
                    const h = document.createElement('div');
                    h.className = 'date-divider';
                    h.innerText = dateStr;
                    list.appendChild(h);
                    lastDate = dateStr;
                }

                const card = document.createElement('div');
                card.className = 'event-card';
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-3">
                            <span class="text-xs font-black tracking-tighter ${e.type === 'milonga' ? 'milonga-indicator' : 'class-indicator'}">${formatTime(e.start)} - ${formatTime(e.end)}</span>
                            <span class="room-pill">${e.room}</span>
                        </div>
                        <span class="price-text">${e.price}</span>
                    </div>
                    <h3 class="text-xl font-bold leading-tight mb-2" style="color: var(--text-primary)">${e.title}</h3>
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-[11px] font-bold uppercase tracking-wider" style="color: var(--text-secondary)">${e.level}</span>
                        <span style="color: var(--border-color)">â€¢</span>
                        <span class="text-[11px] font-bold uppercase tracking-wider" style="color: var(--accent-purple)">${e.instructor}</span>
                    </div>
                    <p class="text-[14px] leading-relaxed font-normal" style="color: var(--text-secondary)">${e.description}</p>
                `;
                list.appendChild(card);
            });
        }

        window.addEventListener('load', () => {
            initSettings();
            updateFilterUI();
            renderEvents();
        });
    </script>
</body>
</html>